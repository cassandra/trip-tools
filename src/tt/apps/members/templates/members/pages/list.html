{% extends "trips/pages/trip_base.html" %}
{% load static %}
{% load icons %}

{% block trip_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h2 mb-1">Trip Members</h1>
    <p class="text-muted">Manage who has access to this trip</p>
  </div>
  {% if can_manage_members %}
  <div>
    <a href="{% url 'members_invite' trip_id=trip_page.trip.pk %}" class="btn btn-primary" data-async-modal>
      {% icon "plus" %}
      Invite Member
    </a>
  </div>
  {% endif %}
</div>

{% if members %}
<div class="list-group">
  {% for member in members %}
  <div class="list-group-item">
    <div class="d-flex w-100 justify-content-between align-items-start">
      <div class="flex-grow-1">
        <div class="d-flex align-items-center mb-2">
          <h5 class="mb-0 me-3">
            {% if member.user.get_full_name %}
              {{ member.user.get_full_name }}
            {% else %}
              {{ member.user.email }}
            {% endif %}
          </h5>
          <span class="badge bg-{{ member.permission_level.name|lower }}">
            {{ member.permission_level.label }}
          </span>
        </div>

        {% if member.user.email != member.user.get_full_name %}
        <p class="mb-1 text-muted">{{ member.user.email }}</p>
        {% endif %}

        {% if is_owner and member.added_by %}
        <small class="text-muted">
          Added by {{ member.added_by.email }} on {{ member.added_datetime|date:"M j, Y" }}
        </small>
        {% endif %}
      </div>

      <div class="btn-group">
        {% if member.can_modify %}
        <a href="{% url 'members_change_permission' trip_id=trip_page.trip.pk member_id=member.pk %}"
           class="btn btn-sm btn-outline-secondary"
           data-async-modal
           title="Change Permission">
          {% icon "edit" %}
        </a>
        <a href="{% url 'members_remove' trip_id=trip_page.trip.pk member_id=member.pk %}"
           class="btn btn-sm btn-outline-danger"
           data-async-modal
           title="Remove Member">
          {% icon "delete" %}
        </a>
        {% elif member.user == request.user %}
        <a href="{% url 'members_remove' trip_id=trip_page.trip.pk member_id=member.pk %}"
           class="btn btn-sm btn-outline-secondary"
           data-async-modal>
          Leave Trip
        </a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="alert alert-info">
  <h4>No members yet</h4>
  <p>This trip has no members.</p>
</div>
{% endif %}

<div class="mt-4">
  <h3 class="h5">Permission Levels</h3>
  <dl class="row">
    <dt class="col-sm-2">Owner</dt>
    <dd class="col-sm-10">Full control including deletion and sharing</dd>

    <dt class="col-sm-2">Admin</dt>
    <dd class="col-sm-10">Can edit and manage most aspects including inviting members</dd>

    <dt class="col-sm-2">Editor</dt>
    <dd class="col-sm-10">Can edit trip content but cannot manage members</dd>

    <dt class="col-sm-2">Viewer</dt>
    <dd class="col-sm-10">Can view trip content but cannot make changes</dd>
  </dl>
</div>
{% endblock %}
