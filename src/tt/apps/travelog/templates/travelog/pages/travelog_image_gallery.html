{% extends "travelog/pages/base.html" %}
{% load travelog_tags %}

{% block head_title %}{{ content.title }} - Image Gallery{% endblock %}

{% block content %}
<div class="container">
  <nav class="nav-breadcrumb">
    <a href="{% travelog_url 'travelog_toc' journal.uuid travelog_page.get_version_param %}" class="nav-link">
      &larr; Back to {{ content.title }}
    </a>
  </nav>

  <h1>{{ content.title }} - Image Gallery</h1>
  <p class="subtitle">{{ travelog_page.content_type.label }}{% if travelog_page.version_number %} (Version {{ travelog_page.version_number }}){% endif %}</p>
  <p class="text-muted">Total images: {{ pagination.item_count }}{% if pagination.required %} | Page {{ pagination.page_number }} of {{ pagination.page_count }}{% endif %}</p>

  {% if images %}
  <div class="image-gallery">
    {% for img in images %}
    <div>
      {% if img.trip_image and img.trip_image.thumbnail_image %}
      <a href="{% travelog_url 'travelog_image_browse' journal.uuid travelog_page.get_version_param image_uuid=img.metadata.uuid %}" class="clickable-card">
        <div class="gallery-item">
          <img src="{{ img.trip_image.thumbnail_image.url }}" alt="Image" class="gallery-image">
        </div>
      </a>
      {% else %}
      <div class="gallery-item">
        <div class="gallery-image placeholder-image"></div>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  <!-- Pagination controls -->
  {% if pagination.required %}
  <div class="pagination">
    {% if pagination.has_previous_page %}
    <a href="{% travelog_url 'travelog_gallery_page' journal.uuid travelog_page.get_version_param page_num=pagination.previous_page_number %}" class="nav-link">
      &larr; Previous
    </a>
    {% endif %}

    {% if pagination.has_pages_before %}
    <a href="{% travelog_url 'travelog_gallery_page' journal.uuid travelog_page.get_version_param page_num=1 %}" class="nav-link">1</a>
    <span>...</span>
    {% endif %}

    {% for page_num in pagination.page_number_list %}
    {% if page_num == pagination.page_number %}
    <span class="current">{{ page_num }}</span>
    {% else %}
    <a href="{% travelog_url 'travelog_gallery_page' journal.uuid travelog_page.get_version_param page_num=page_num %}" class="nav-link">{{ page_num }}</a>
    {% endif %}
    {% endfor %}

    {% if pagination.has_pages_after %}
    <span>...</span>
    <a href="{% travelog_url 'travelog_gallery_page' journal.uuid travelog_page.get_version_param page_num=pagination.page_count %}" class="nav-link">{{ pagination.page_count }}</a>
    {% endif %}

    {% if pagination.has_next_page %}
    <a href="{% travelog_url 'travelog_gallery_page' journal.uuid travelog_page.get_version_param page_num=pagination.next_page_number %}" class="nav-link">
      Next &rarr;
    </a>
    {% endif %}
  </div>
  {% endif %}
  {% else %}
  <p>No images in this travelog.</p>
  {% endif %}
</div>
{% endblock %}
