{% extends "pages/secondary-page-simple.html" %}
{% load static %}

{% block main_extra_actions %}
<div class="mr-2">
  <span id="save-status" class="text-light">
    <small><em>Loading...</em></small>
  </span>
</div>
{% endblock %}

{% block secondary_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h2 mb-1">{% if entry %}Edit Note{% else %}New Note{% endif %}</h1>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb bg-transparent p-0 mb-0">
        <li class="breadcrumb-item">
          <a href="{% url 'trips_home' trip_id=trip.pk %}">{{ trip.title }}</a>
        </li>
        <li class="breadcrumb-item">
          <a href="{% url 'notebook_list' trip_id=trip.pk %}">Notes</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{% if entry %}{{ entry.date|date:'M j' }}{% else %}New{% endif %}</li>
      </ol>
    </nav>
  </div>
</div>

<form id="notebook-form" method="post">
  {% csrf_token %}

  <div class="form-group">
    <label for="id_date">Date</label>
    {{ form.date }}
    {% if form.date.errors %}
    <div class="invalid-feedback d-block">
      {{ form.date.errors }}
    </div>
    {% endif %}
  </div>

  <div class="form-group">
    <label for="id_text">Note Content</label>
    {{ form.text }}
    {% if form.text.errors %}
    <div class="invalid-feedback d-block">
      {{ form.text.errors }}
    </div>
    {% endif %}
  </div>
</form>

<div class="mt-3">
  <a href="{% url 'notebook_list' trip_id=trip.pk %}" class="btn btn-secondary">Back to Notes</a>
</div>
{% endblock %}

{% block footer_post_javascript %}
{{ block.super }}
<script>
// Auto-save configuration
window.notebookConfig = {
  autosaveUrl: '{% url "notebook_autosave" trip_id=trip.pk entry_pk=entry.pk %}',
  csrfToken: '{{ csrf_token }}'
};
</script>
<script src="{% static 'js/notebook.js' %}"></script>
{% endblock %}
