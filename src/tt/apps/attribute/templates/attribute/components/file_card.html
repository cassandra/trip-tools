{% load icons attribute_extras %}
{% comment %}
V2 File Card Component
Individual file attribute card with preview, actions, and metadata
{% endcomment %}

<div class="{{ TtConst.ATTR_FILE_CARD_CLASS }}" 
     {{ TtConst.DATA_ATTRIBUTE_ID_ATTR }}="{{ attribute.id }}" 
     data-url-detect="true"
     data-order-index="{{ forloop.counter }}"
     data-thumbnail-ready="true"
     data-mime-type="{{ attribute.file_mime_type|default:'unknown' }}"
     data-file-size="{{ attribute.file_value.size|default:0 }}">
  
  <!-- Hidden field for deletion marking -->
  <input type="hidden" 
         name="{{ TtConst.ATTR_DELETE_FILE_ATTR }}" 
         value="" 
         {{ TtConst.DATA_ATTRIBUTE_ID_ATTR }}="{{ attribute.id }}">
  
  <!-- File Preview/Thumbnail Area -->
  <div class="attr-file-thumbnail" 
       onclick="window.open('{{ attribute.file_value.url }}', '_blank');" 
       title="Tap to view file">
    {% comment %}Content-type specific placeholder icons{% endcomment %}
    {% if attribute.file_mime_type|slice:':5' == "image" %}
      {% icon "camera" size="lg" %}
      <div class="attr-file-type-label">IMAGE</div>
    {% elif attribute.file_mime_type == "application/pdf" %}
      {% icon "upload" size="lg" %}
      <div class="attr-file-type-label">PDF</div>
    {% elif attribute.file_mime_type|slice:':4' == "text" %}
      {% icon "edit" size="lg" %}
      <div class="attr-file-type-label">TEXT</div>
    {% elif attribute.file_mime_type|slice:':5' == "video" %}
      {% icon "video" size="lg" %}
      <div class="attr-file-type-label">VIDEO</div>
    {% else %}
      {% icon "upload" size="lg" %}
      <div class="attr-file-type-label">FILE</div>
    {% endif %}
    
    <!-- Reorder Controls (overlay in upper right) -->
    <div class="attr-reorder-controls" 
         onclick="event.stopPropagation();"
         onmouseenter="this.parentElement.classList.add('reorder-hover');"
         onmouseleave="this.parentElement.classList.remove('reorder-hover');">
      <button type="button" 
              class="btn btn-sm btn-outline-secondary"
              disabled
              title="Reordering available in future update"
              data-reorder-action="left">
        {% icon "chevron-left" size="sm" %}
      </button>
      <button type="button" 
              class="btn btn-sm btn-outline-secondary"
              disabled
              title="Reordering available in future update"
              data-reorder-action="right">
        {% icon "chevron-right" size="sm" %}
      </button>
    </div>
  </div>
  
  <!-- File Info -->
  <div class="{{ TtConst.ATTR_FILE_INFO_CLASS }}">
    <input type="text" 
           id="{{ attr_item_context|file_title_field_name:attribute.id }}"
           name="{{ attr_item_context|file_title_field_name:attribute.id }}" 
           value="{{ attribute.value }}" 
           class="{{ TtConst.ATTR_FILE_TITLE_INPUT_CLASS }}"
           placeholder="Enter file title"
           maxlength="255">
    <div class="attr-file-filename">{{ attribute.name }}</div>
    
    <!-- File Actions -->
  <div class="attr-file-actions">
    <button type="button" 
            class="btn btn-sm btn-outline-primary"
            onclick="window.open('{{ attribute.file_value.url }}', '_blank');"
            title="View file">
      {% icon "eye" size="sm" %}
    </button>
    
    {% if attribute.attribute_type.can_delete %}
      <button type="button" 
              class="btn btn-sm btn-outline-danger {{ TtConst.ATTR_DELETE_BTN_CLASS }}"
              onclick="markFileForDeletion('{{ attribute.id }}', '#{{ attr_page_context.container_html_id }}')"
              title="Delete file">
        {% icon "delete" size="sm" %}
      </button>
      <button type="button" 
              class="btn btn-sm btn-outline-secondary {{ TtConst.ATTR_UNDO_BTN_CLASS }}"
              onclick="undoFileDeletion('{{ attribute.id }}', '#{{ attr_page_context.container_html_id }}')"
              title="Undo deletion"
              style="display: none;">
        Undo
      </button>
    {% endif %}
    </div>
  </div>
</div>
