{% load icons %}
{% comment %}
Secret Attribute Value Component
Renders a password input with show/hide toggle for existing secret attributes

UI Interactions:

When adding a new secret attribute, it looks exactly the same as adding a
text attribute. There is a checkbox they use to indicate if it is secret.
Secrets are limited to a single line of text, which is enforced on form
submission.  The new attribute value textarea allows any text, so it is a
form validation error for them to add multi-line text and choose the "Mark
as Secret" box.  Once created, a SECRET is a text input, not a text area
and there is no ability to change a secret into a non-secret or vice
versa. Thus, there is no checkbox on existing attributes to control if it
is a secret: that only appears on the new attribute form.
{% endcomment %}

<div class="attr-v2-secret-field">
  <div class="{{ DIVID.ATTR_V2_SECRET_INPUT_WRAPPER_CLASS }}">
    <!-- Secret field as password input -->
    {% if attribute_form.show_secrets %}
    <input type="text" 
           id="{{ attribute_form.value.id_for_label }}"
           name="{{ attribute_form.value.html_name }}"
           class="form-control {{ DIVID.ATTR_V2_SECRET_INPUT_CLASS }}"
           value="{{ attribute_form.value.value|default_if_none:'' }}"
           {% if attribute_form.instance and not attribute_form.instance.is_editable %}disabled="true"{% endif %} />
    {% else %}
    <input type="password" 
           id="{{ attribute_form.value.id_for_label }}"
           name="{{ attribute_form.value.html_name }}"
           class="form-control {{ DIVID.ATTR_V2_SECRET_INPUT_CLASS }}"
           value="{{ attribute_form.value.value|default_if_none:'' }}"
           readonly="readonly"
           {% if attribute_form.instance and not attribute_form.instance.is_editable %}disabled="true"{% endif %} />
    <button type="button" 
            class="btn btn-sm btn-outline-secondary attr-v2-secret-toggle"
            onclick="Hi.attr.toggleSecretField(this)"
            title="Show value">
      <span class="{{ DIVID.ATTR_V2_ICON_SHOW_CLASS }}">{% icon "eye" size="sm" %}</span>
      <span class="{{ DIVID.ATTR_V2_ICON_HIDE_CLASS }}" style="display: none;">{% icon "eye-off" size="sm" %}</span>
    </button>
    {% endif %}
  </div>
  {% if attribute_form.value.errors %}
    <div class="attr-v2-field-errors">
      {% for error in attribute_form.value.errors %}
      <div class="attr-v2-error-text">{{ error }}</div>
      {% endfor %}
    </div>
    {% endif %}
</div>
