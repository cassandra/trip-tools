{% load static %}
{% load icons %}

<!-- Panel Header - Fixed -->
<div class="{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_PANEL_HEADER_CLASS }}">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">Images</h5>
    <a href="{% url 'journal_editor_multi_image_upload' entry_uuid=entry.uuid %}"
       class="btn btn-sm btn-outline-primary"
       data-async="modal">
      {% icon "upload" size="sm" css_class="tt-icon-left" %}
      Upload
    </a>
  </div>

  <!-- Date and Scope Filter Form -->
  <form method="get" action="{% url 'journal_editor_multi_images' entry_uuid=entry.uuid %}" data-async="#{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_GALLERY_ID }}" data-mode="insert" id="{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_FILTER_FORM_ID }}" data-{{ TtConst.INITIAL_SCOPE_DATA_ATTR }}="{{ image_picker_data.scope }}">
    <!-- Date Filter with Entry Date and Recent Buttons -->
    <div class="d-flex mb-2">
      <input
          type="date"
          class="form-control form-control-sm"
          id="{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_DATE_INPUT_ID }}"
          name="date"
          {% if not image_picker_data.is_recent_mode and image_picker_data.filter_date %}value="{{ image_picker_data.filter_date|date:'Y-m-d' }}"{% endif %}
      >
      <button
          type="button"
          id="{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_ENTRY_DATE_BTN_ID }}"
          class="btn btn-sm {% if not image_picker_data.is_recent_mode and image_picker_data.last_date %}btn-primary{% else %}btn-outline-primary{% endif %} ml-1 flex-shrink-0"
          title="{% if image_picker_data.last_date %}Show images from {{ image_picker_data.last_date|date:'M j, Y' }}{% else %}Select a date first{% endif %}"
          data-{{ TtConst.LAST_USED_DATE_ATTR }}="{% if image_picker_data.last_date %}{{ image_picker_data.last_date|date:'Y-m-d' }}{% endif %}"
          {% if not image_picker_data.last_date %}disabled{% endif %}>
        {% if image_picker_data.last_date %}{{ image_picker_data.last_date|date:"M j" }}{% else %}Date{% endif %}
      </button>
      <button
          type="button"
          class="btn btn-sm {% if image_picker_data.is_recent_mode %}btn-primary{% else %}btn-outline-primary{% endif %} ml-1 flex-shrink-0"
          id="{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_RECENT_BTN_ID }}"
          title="Show recently uploaded images">
        Recent
      </button>
    </div>

    <!-- Scope Filter Pills (client-side filtering only) -->
    <div class="btn-group btn-group-sm btn-group-toggle w-100" data-toggle="buttons">
      <label class="btn btn-outline-secondary {% if image_picker_data.scope.is_unused %}active{% endif %}">
        <input type="radio" name="scope" value="{{ TtConst.IMAGE_PICKER_SCOPE_UNUSED }}" {% if image_picker_data.scope.is_unused %}checked{% endif %}> Unused
      </label>
      <label class="btn btn-outline-secondary {% if image_picker_data.scope.is_used %}active{% endif %}">
        <input type="radio" name="scope" value="{{ TtConst.IMAGE_PICKER_SCOPE_USED }}" {% if image_picker_data.scope.is_used %}checked{% endif %}> Used
      </label>
      <label class="btn btn-outline-secondary {% if image_picker_data.scope.is_all %}active{% endif %}">
        <input type="radio" name="scope" value="{{ TtConst.IMAGE_PICKER_SCOPE_ALL }}" {% if image_picker_data.scope.is_all %}checked{% endif %}> All
      </label>
    </div>
  </form>
</div>

<!-- Image Gallery Grid - Scrollable -->
<div class="{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_GALLERY_CLASS }} row" id="{{ TtConst.JOURNAL_EDITOR_MULTI_IMAGE_GALLERY_ID }}">
  {% include "journal/components/journal_editor_multi_image_gallery_grid.html" with accessible_images=image_picker_data.accessible_images trip=trip image_display_timezone=image_picker_data.image_display_timezone %}
</div>
