{% load icons %}
{% load travelog_tags %}

{# Publishing Status: Color-Coded Alert Box #}
{% if publishing_status.has_published_version %}
{% if publishing_status.has_unpublished_changes %}
{# State 1: Has Unpublished Changes #}
<div class="alert alert-warning mb-0" role="alert">
  <div class="row align-items-center">
    <div class="col-md-8">
      <div class="d-flex align-items-start">
        <div class="mr-2">
          {% icon "exclamation-circle" %}
        </div>
        <div class="flex-grow-1">
          <div class="d-flex align-items-center mb-1">
            <span class="badge badge-{{ journal.visibility.badge_color }} mr-2">
              {% icon journal.visibility.icon_name size="sm" css_class="tt-icon-left" %}
              {{ journal.visibility.label }}
            </span>
            <strong>Version {{ publishing_status.current_published_travelog.version_number }}</strong>
            <span class="text-muted ml-2">
              &bull; Published {{ publishing_status.current_published_travelog.published_datetime|date:"N j, Y" }}
              {% if publishing_status.current_published_travelog.published_by %}
              by {% if publishing_status.current_published_travelog.published_by.get_full_name %}{{ publishing_status.current_published_travelog.published_by.get_full_name }}{% else %}{{ publishing_status.current_published_travelog.published_by.email }}{% endif %}
              {% endif %}
            </span>
          </div>
          <small><strong>You have unpublished changes</strong> that are not yet visible to readers.</small>
        </div>
      </div>
    </div>
    <div class="col-md-4 text-right">
      <div class="btn-group-vertical btn-group-sm" role="group">
        <a href="{% travelog_url 'travelog_toc' journal.uuid %}"
           target="_blank"
           class="btn btn-outline-dark">
          {% icon "eye" size="sm" css_class="tt-icon-left" %}
          View Published
        </a>
        <a href="{% url 'journal_versions' journal_uuid=journal.uuid %}"
           data-async="modal"
           class="btn btn-outline-dark">
          {% icon "history" size="sm" css_class="tt-icon-left" %}
          Version History
        </a>
        <a href="{% url 'journal_visibility' journal_uuid=journal.uuid %}"
           data-async="modal"
           class="btn btn-outline-dark"
           {% if not trip_page.request_member.permission_level.is_admin %}disabled{% endif %}>
          {% icon "shield" size="sm" css_class="tt-icon-left" %}
          Change Visibility
        </a>
      </div>
    </div>
  </div>
</div>
{% else %}
{# State 2: Up to Date #}
<div class="alert alert-success mb-0" role="alert">
  <div class="row align-items-center">
    <div class="col-md-8">
      <div class="d-flex align-items-start">
        <div class="mr-2">
          {% icon "check-circle" %}
        </div>
        <div class="flex-grow-1">
          <div class="d-flex align-items-center mb-1">
            <span class="badge badge-{{ journal.visibility.badge_color }} mr-2">
              {% icon journal.visibility.icon_name size="sm" css_class="tt-icon-left" %}
              {{ journal.visibility.label }}
            </span>
            <strong>Version {{ publishing_status.current_published_travelog.version_number }}</strong>
            <span class="text-muted ml-2">
              &bull; Published {{ publishing_status.current_published_travelog.published_datetime|date:"N j, Y" }}
              {% if publishing_status.current_published_travelog.published_by %}
              by {% if publishing_status.current_published_travelog.published_by.get_full_name %}{{ publishing_status.current_published_travelog.published_by.get_full_name }}{% else %}{{ publishing_status.current_published_travelog.published_by.email }}{% endif %}
              {% endif %}
            </span>
          </div>
          <small><strong>Up to date</strong> â€” your published version matches your working copy.</small>
        </div>
      </div>
    </div>
    <div class="col-md-4 text-right">
      <div class="btn-group-vertical btn-group-sm" role="group">
        <a href="{% travelog_url 'travelog_toc' journal.uuid %}"
           target="_blank"
           class="btn btn-outline-dark">
          {% icon "eye" size="sm" css_class="tt-icon-left" %}
          View Published
        </a>
        <a href="{% url 'journal_versions' journal_uuid=journal.uuid %}"
           data-async="modal"
           class="btn btn-outline-dark">
          {% icon "history" size="sm" css_class="tt-icon-left" %}
          Version History
        </a>
        <a href="{% url 'journal_visibility' journal_uuid=journal.uuid %}"
           data-async="modal"
           class="btn btn-outline-dark"
           {% if not trip_page.request_member.permission_level.is_admin %}disabled{% endif %}>
          {% icon "shield" size="sm" css_class="tt-icon-left" %}
          Change Visibility
        </a>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% else %}
{# State 3: Not Yet Published #}
<div class="alert alert-info mb-0" role="alert">
  <div class="row align-items-center">
    <div class="col-md-8">
      <div class="d-flex align-items-start">
        <div class="mr-2">
          {% icon "info-circle" %}
        </div>
        <div class="flex-grow-1">
          <div class="d-flex align-items-center mb-1">
            <span class="badge badge-{{ journal.visibility.badge_color }} mr-2">
              {% icon journal.visibility.icon_name size="sm" css_class="tt-icon-left" %}
              {{ journal.visibility.label }}
            </span>
            <strong>Not yet published</strong>
          </div>
          <small>Create some journal entries and publish your first version when ready.</small>
        </div>
      </div>
    </div>
    <div class="col-md-4 text-right">
      <div class="btn-group-vertical btn-group-sm" role="group">
        <a href="{% url 'journal_visibility' journal_uuid=journal.uuid %}"
           data-async="modal"
           class="btn btn-outline-dark"
           {% if not trip_page.request_member.permission_level.is_admin %}disabled{% endif %}>
          {% icon "shield" size="sm" css_class="tt-icon-left" %}
          Change Visibility
        </a>
      </div>
    </div>
  </div>
</div>
{% endif %}
