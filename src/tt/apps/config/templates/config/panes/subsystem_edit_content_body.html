{% extends "attribute/components/edit_content_body.html" %}
{% load icons %}
{% load attribute_extras %}
{% comment %}
Config Settings Content Body Fragment
Contains the main content area - used by both initial load and updates
This is what gets replaced on form submission
{% endcomment %}

{% block basic_info %}{% endblock %}

{% block additional_actions %}
<h4 class="mb-0 text-muted {{ DIVID.ATTR_V2_FORM_DISPLAY_LABEL_CLASS }}">
  {% for multi_edit_form_data in multi_edit_form_data_list %}
    {% if selected_subsystem_id == multi_edit_form_data.owner.id|stringformat:'s' %}
      {{ multi_edit_form_data.owner.name }} Settings
    {% endif %}
  {% empty %}
    System Settings
  {% endfor %}
</h4>
{% endblock %}

{% block file_upload_button %}{% endblock %}

{% block add_attribute_button %}{% endblock %}

{% block files_section %}{% endblock %}

{% block left_column %} 
<nav class="nav flex-column hi-vertical-nav mr-3" id="subsystemTabs" role="tablist">
  {% for multi_edit_form_data in multi_edit_form_data_list %}
  <a class="nav-link hi-vertical-nav-link {% if selected_subsystem_id == multi_edit_form_data.owner.id|stringformat:'s' %}active{% endif %}" 
     id="subsystem-{{ multi_edit_form_data.owner.id }}-tab" 
     data-toggle="tab" 
     data-subsystem-id="{{ multi_edit_form_data.owner.id }}"
     data-config-settings-url="{% url 'config_settings' %}"
     href="#subsystem-{{ multi_edit_form_data.owner.id }}-panel" 
     role="tab" 
     aria-controls="subsystem-{{ multi_edit_form_data.owner.id }}-panel" 
     aria-selected="{% if selected_subsystem_id == multi_edit_form_data.owner.id|stringformat:'s' %}true{% else %}false{% endif %}"
     onclick="window.Hi.attr.updateFormAction('{% url 'config_settings' subsystem_id=multi_edit_form_data.owner.id %}', '{{ attr_page_context.container_html_id }}', '{{ multi_edit_form_data.owner.name }} Settings')">
    {{ multi_edit_form_data.owner.name }}
    {% if multi_edit_form_data.error_count > 0 %}
    <span class="badge badge-danger ml-1">{{ multi_edit_form_data.error_count }}</span>
    {% endif %}
  </a>
  {% endfor %}
</nav>
{% endblock %}

{% block properties_section %}

<!-- Vertical Tabbed Subsystem Interface -->
<div class="tab-content" id="subsystemTabContent">

  {% for multi_edit_form_data in multi_edit_form_data_list %}
  <div class="tab-pane fade {% if selected_subsystem_id == multi_edit_form_data.owner.id|stringformat:'s' %}show active{% endif %}" 
       id="subsystem-{{ multi_edit_form_data.owner.id }}-panel" 
       role="tabpanel" 
       aria-labelledby="subsystem-{{ multi_edit_form_data.owner.id }}-tab">
    
    <!-- Subsystem content using existing attribute editing components -->
    <div class="">
      {% if multi_edit_form_data.owner.subsystem_key == "tt.apps.audio" %}
      <!-- Audio Test Button - only shown for Audio subsystem -->
      <div class="mb-3 text-right">
        <button type="button"
                class="btn btn-outline-primary btn-xs"
                onclick="Tt.audio.testAudio();"
                title="Test audio playback">
          {% icon "play" size="xs" css_class="hi-icon-left" %}Test Audio
        </button>
      </div>
      {% endif %}
      {% include "attribute/components/regular_attribute_list.html" with regular_attributes_formset=multi_edit_form_data.formset attr_item_context=multi_edit_form_data.context %}
    </div>
    
  </div>
  {% endfor %}
</div>  
{% endblock %}
